<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.AdminMemberMapper">

    <!-- 기본 회원 목록 조회 -->
    <select id="selectBasicMembers" resultType="com.example.demo.model.AdminMember">
        SELECT 
            client_id,
            name,
            phone,
            email_id AS emailId,
            email_domain AS emailDomain,
            addr_base,
            state
        FROM client
    </select>

    <!-- 상태 변경 -->
    <update id="updateState">
        UPDATE client
        SET state = #{state}
        WHERE client_id = #{id}
    </update>

    <!-- 검색 + 페이징된 회원 목록 조회 -->
    <select id="pagingSearch" resultType="com.example.demo.model.AdminMember">
        SELECT 
            client_id,
            name,
            phone,
            email_id AS emailId,
            email_domain AS emailDomain,
            addr_base,
            state
        FROM client
        <where>
            <if test="type != null and keyword != null and keyword != ''">
                <choose>
                    <when test="type == 'name'">
                        name LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'email'">
                        CONCAT(email_id, '@', email_domain) LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'state'">
                        state = #{keyword}
                    </when>
                </choose>
            </if>
        </where>
        ORDER BY reg_date DESC
        LIMIT #{startRow}, #{endRow}
    </select>

    <!-- 검색 결과 총 개수 -->
    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*) FROM client
        <where>
            <if test="type != null and keyword != null and keyword != ''">
                <choose>
                    <when test="type == 'name'">
                        name LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'email'">
                        CONCAT(email_id, '@', email_domain) LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'state'">
                        state = #{keyword}
                    </when>
                </choose>
            </if>
        </where>
    </select>

</mapper>
